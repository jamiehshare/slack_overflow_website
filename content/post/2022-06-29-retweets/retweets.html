---
title: "Extract Comment from Quote Tweet"
author: "Jamie Hudson, Data Scientist"
date: "2022-06-29"
categories: ["tidyverse", "janitor"]
tags: ["twitter","retweets", "data cleaning"]
output:
  html_document:
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
---



<div id="topic-originally-suggested-by-jack-penzer-data-scientist" class="section level4">
<h4><em>Topic originally suggested by Jack Penzer, Data Scientist</em></h4>
</div>
<div id="the-problem" class="section level2">
<h2>The Problem</h2>
<p>üö®<strong>Note this is only relevant to data that has not come from Sprinklr. Quoted retweet‚Äôs are classified as mentions in Sprinklr and only simple retweets are considered retweets</strong>üö®</p>
<p>When creating bigram networks and performing topic modelling on Twitter data it can often be difficult to deal with retweets (RTs).</p>
<p>If we leave all RTs in the data set, the bigram networks will comprise only the most retweeted RTs, as will most of the topics inferred through topic modelling.</p>
<p>However, if we blanket remove all RTs, we will also lose the quote RTs, which contain text separate from the RT.</p>
</div>
<div id="the-solution" class="section level2">
<h2>The Solution</h2>
<p>A happy medium is to remove the retweeted part of each quote RT, leaving the novel text to be analysed separately (which will not disrupt our bigram networks and topic modelling processes).</p>
<p>Warning: check the specific output of RTs first as in the third code block.</p>
<p>First things first, let‚Äôs load the libraries we will be using:</p>
<pre class="r"><code>library(tidyverse)
library(janitor)</code></pre>
<p>And then load in some sample data, which we will call <code>demo</code>. You will see I also select only a few columns, this is for clarity in visualising the data frame in this tutorial and we do not recommend selecting such few columns for a real-life situation.</p>
<pre class="r"><code>demo &lt;- read_csv(&quot;data/demo.csv&quot;) %&gt;%
  janitor::clean_names() %&gt;%
  dplyr::select(date, media_type, publisher_username, mention_content)
  utils::head(20)</code></pre>
<pre><code>## [1] 20</code></pre>
<pre class="r"><code>head(demo)</code></pre>
<pre><code>## # A tibble: 6 √ó 4
##   date       media_type publisher_username mention_content                      
##   &lt;date&gt;     &lt;chr&gt;      &lt;chr&gt;              &lt;chr&gt;                                
## 1 2022-06-02 Twitter    PradoEirin         La ilustraci√≥n de hoy en @_Boreal_ p‚Ä¶
## 2 2022-06-02 Twitter    AugustoMetztli     La mayonesa, el pan bimbo‚Ä¶ y Get¬†Bac‚Ä¶
## 3 2022-06-02 Twitter    _Boreal_           La mayonesa, el pan bimbo‚Ä¶ y Get¬†Bac‚Ä¶
## 4 2022-06-02 Twitter    ANYWAYSNOW         no hay absolutamente nada para desay‚Ä¶
## 5 2022-06-02 Twitter    monnuwrai          despu√©s del caldito me com√≠ un pedaz‚Ä¶
## 6 2022-06-02 Twitter    nathmarz           A punto de morir por comer unas puta‚Ä¶</code></pre>
<p>In this example, we can see that our text variable is stored in a column called <code>mention_content</code>. For illustrative purposes, let‚Äôs rename this to <code>text</code> and then find us some RTs:</p>
<pre class="r"><code>demo_RTs &lt;- demo %&gt;%
  dplyr::rename(text = mention_content) %&gt;%
  dplyr::select(text) %&gt;%
  dplyr::filter(str_detect(text, &quot;\\bRT\\b&quot;))</code></pre>
<p>We use the function <code>str_detect()</code> to search for strings within the <code>text</code> column that match the regex pattern <code>"\\bRT\\b</code>. This pattern tells R to find the term ‚ÄúRT‚Äù before and after word boundaries (the transition between word and non-word characters), meaning we will not find words such as ‚ÄúFURTHER‚Äù, as the ‚ÄúRT‚Äù is not next to a word boundary.</p>
<p>By viewing <code>demo_RTs</code>, we can see we have two posts that match the filtering criteria:</p>
<pre class="r"><code>demo_RTs</code></pre>
<pre><code>## # A tibble: 2 √ó 1
##   text                                                                          
##   &lt;chr&gt;                                                                         
## 1 Se mamaron con los precios yo con un kilo de arroz y una bolsa pan de bimbo e‚Ä¶
## 2 ¬°Uy, qu√© miedo! ¬øD√≥nde ha estado desde diciembre de 2018? Yo me acuerdo que u‚Ä¶</code></pre>
<p>The eagle-eyed amongst us will notice both of these posts have the quoted text before a ‚Äù RT @‚Äù pattern- so they come with a RT tag followed by the username of the person they‚Äôre retweeting followed by the original tweet.</p>
<p>Now let‚Äôs mutate a new column and name it <code>rt_info</code>. This will check if the post is a RT, and if it is, take the RT tag and the proceeding text and add it to a new column.</p>
<p>Then in the next mutate we‚Äôll edit our <code>text</code> column, checking if each post is a RT, and if it is we‚Äôll extract all the text up to the RT tag and forget about the rest - which is stored in rt_info:</p>
<pre class="r"><code>demo_RTs &lt;- demo_RTs  %&gt;%
  mutate(rt_info = ifelse(str_detect(text, &quot;\\bRT\\b&quot;), str_match(text, &quot;\\bRT\\b @.*&quot;), &quot;emptystring&quot;)) %&gt;%
  mutate(text = ifelse(str_detect(text, &quot;\\bRT\\b&quot;), str_match(text, &quot;.* \\bRT\\b&quot;), text))

demo_RTs</code></pre>
<pre><code>## # A tibble: 2 √ó 2
##   text                                                                   rt_info
##   &lt;chr&gt;                                                                  &lt;chr&gt;  
## 1 Se mamaron con los precios yo con un kilo de arroz y una bolsa pan de‚Ä¶ RT @jo‚Ä¶
## 2 ¬°Uy, qu√© miedo! ¬øD√≥nde ha estado desde diciembre de 2018? Yo me acuer‚Ä¶ RT @re‚Ä¶</code></pre>
<p>Now we can see that our <code>text</code> column has two posts, each of them quoted RTs, and our <code>rt_info</code> column includes all information relating to the RT itself. Now we can analyse the quoted RTs, and the original tweets‚Äô information if need be.</p>
<p>üö®<strong>Note leaving the ‚ÄúRT‚Äù at the end of the quoted RTs is intentional, so that posts can still be tracked easily as quote RTs, and in the topic modelling process we‚Äôll still see that the topic comprises a number of quote RTs, but can be removed with mutate <code>(text = str_remove_all(text, "\\bRT\\b"))</code></strong>üö®</p>
</div>
