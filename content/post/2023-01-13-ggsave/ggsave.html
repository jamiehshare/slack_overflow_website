---
title: "Consistently Save Plots"
author: "Jamie Hudson, Data Scientist"
date: "2022-06-29"
categories: ["tidyverse", "ggplot2"]
tags: ["ggplot2", "ggsave", "figures"]
output:
  html_document:
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
---



<div id="answers-originally-suggested-by-jamie-hudson-data-scientist-and-jack-penzer-senior-data-scientist" class="section level4">
<h4><em>Answers originally suggested by Jamie Hudson, Data Scientist and Jack Penzer, Senior Data Scientist</em></h4>
</div>
<div id="the-problem" class="section level2">
<h2>The Problem</h2>
<p>It is important to be able to export/save the figures created in R in a consistent manner, so that throughout a deck all plots of a similar type (e.g.¬†all bigrams) are the same size and resolution.</p>
<p>If plots are saved using the Plots panel by clicking <code>Export</code> and <code>Save as image</code>, it is very easy to accidentally save plots as different sizes (and you cannot alter the resolution from the default value).</p>
<center>
<div class="figure">
<img src="../img/save_panel.png" alt="" />
<p class="caption"><em>Save Panel in RStudio</em></p>
</div>
</center>
</div>
<div id="the-solution" class="section level2">
<h2>The Solution</h2>
<p>The best way to get around this is to use the <code>ggsave()</code> function from the <code>ggplot2</code> library.</p>
<p>This function is super convenient and by default saves the last plot that you have displayed in the Plot pane. It also guesses the type of graphics device from the extension of the saved image.</p>
<p>The function works like:</p>
<pre class="r"><code>ggsave(filename = &quot;CHANGE_NAME_TO_SOMETHING_SUITABLE.png&quot;,      
       bg = &quot;white&quot;,
       height = 6,
       width = 8)</code></pre>
<p>where height = 6 and width = 8 tend to be good values to use, and means every plot produced using this code will be the same size ( 6 x 8 ) and makes for nice consistent sizing for decks. As mentioned, by default this function saves the last produced plot (i.e.¬†the one in the Plot pane of RStudio if you have just ran some code to make a plot).</p>
</div>
<div id="but-wait-theres-more" class="section level2">
<h2><em>But wait, there‚Äôs more</em></h2>
<p>Jack‚Äôs produced a neat wrapper function that currently sits in the <code>JPackage</code> library called <code>plot_save()</code>. This function has appropriate defaults for height, width and plot resolution (dpi), so unless we explicitly want these to change, we can just ignore them from the function.</p>
<p>Therefore to use this function to save a plot, all we need to do is provide the filepath of the location we want to save the plot, with the name of the plot. For example:</p>
<pre class="r"><code>JPackage::plot_save(filename = &quot;drive/folder/project/viz/CHANGE_NAME_TO_SOMETHING_SUITABLE.png&quot;)</code></pre>
</div>
<div id="bonus-tip" class="section level2">
<h2>üéÅ Bonus Tip üéÅ</h2>
<p>Now, this works great for when we create and want to save a single plot. But for some of the workflows, we produce multiple plots at once (for example the bigrams during LDA topic modelling).</p>
<p>To perform this, we need to do some slightly more complex coding which applies a function (i.e.¬†<code>JPackage::plot_save()</code>) across a list or a vector. To show this, let‚Äôs pluck the bigrams from an LDA workflow:</p>
<pre class="r"><code>bigrams &lt;- ldas %&gt;%
  filter(k == 5, freq_cutoff == 200) %&gt;% 
  SegmentR::explore_LDAs(top_terms = FALSE,
                         diff_terms = FALSE,
                         bigrams = TRUE,
                         bigram_n = 25,
                         exemplars = FALSE) %&gt;%
  pluck(&#39;bigrams&#39;, 1)</code></pre>
<p>This creates a list of the (in this case 5 [because we have filtered for <code>k == 5</code>]) bigrams. Each of these bigrams has a name, and what we can do is append perhaps the value of K onto each of these names using the following code:</p>
<pre class="r"><code>k_val &lt;- 5 # assign a numeric vector called k_val the value of 5</code></pre>
<p>We can view the current names of the bigrams</p>
<pre class="r"><code>names(bigrams)</code></pre>
<p>And then rename them with the appended k value:</p>
<pre class="r"><code>names(bigrams) &lt;- paste0(names(bigrams), &quot;_&quot;, &quot;k&quot;, &quot;_&quot;, k_val) </code></pre>
<p>Now we can apply <code>JPackage::plot_save()</code> to the list of bigrams using the function <code>lapply()</code>.</p>
<pre class="r"><code>lapply(names(bigrams),
       function(x) JPackage::plot_save(
         dir = paste0(&quot;drive/folder/project/viz/bigrams_&quot;, x, &quot;.png&quot;), 
         plot = bigrams[[x]]
         )
       )</code></pre>
<p>What each of these lines does is:</p>
<ul>
<li><p><code>lapply(names(bigrams)</code> starts a loop that will iterate over the names of the objects in the bigrams list. Note, that if your bigrams list has a different name, it should be changed here too (i.e.¬†<code>lapply(names(DIFFERENT_NAME))</code>).</p></li>
<li><p><code>function(x)</code> is what is known as an anonymous function which takes a single argument known as <code>x</code>, which in this case is an individual name from the bigram list.</p></li>
<li><p><code>JPackage::plot_save</code> is the function that is called to save the plots</p></li>
<li><p><code>filename = paste0("drive/folder/project/viz/bigrams_", x, ".png")</code> creates a file name for the saved plot abd saves these to the <code>drive/folder/project/viz/</code> folder (which should be changed to something suitable) and names each bigram in this folder <code>bigram_THE_NAME_OF_THE_BIGRAM.png</code>.</p></li>
<li><p><code>plot = bigrams[[x]]</code> specifies the plot to be saved. The [[x]] notation retrieves the element of the bigrams list with name x. Again, if the bigram list has a different name, it should be changed here too (i.e.¬†<code>plot = DIFFERENT_NAME[[x]]</code>).</p></li>
</ul>
</div>
